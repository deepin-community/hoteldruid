#!/bin/sh
# postrm script for hoteldruid
#
# see: dh_installdeb(1)

set -e

# summary of how this script can be called:
#        * <postrm> `remove'
#        * <postrm> `purge'
#        * <old-postrm> `upgrade' <new-version>
#        * <new-postrm> `failed-upgrade' <old-version>
#        * <new-postrm> `abort-install'
#        * <new-postrm> `abort-install' <old-version>
#        * <new-postrm> `abort-upgrade' <old-version>
#        * <disappearer's-postrm> `disappear' <overwriter>
#          <overwriter-version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package



case "$1" in
  purge)

  if [ -e /usr/share/debconf/confmodule ]; then

    . /usr/share/debconf/confmodule
    db_get hoteldruid/configure-apache || true
    if [ "$RET" = "true" ]; then
    if [ -e /usr/share/apache2/apache2-maintscript-helper ]
    then
      . /usr/share/apache2/apache2-maintscript-helper
      apache2_invoke disconf hoteldruid
    fi
    rm -f /etc/apache2/conf-available/hoteldruid.conf
    fi

    if [ -d "/var/lib/hoteldruid" ]; then
      db_input medium hoteldruid/purgedata || true
      db_go
      db_get hoteldruid/purgedata || true
      if [ "$RET" = "true" ]; then
        rm -rf /var/lib/hoteldruid/data/*
        rm -rf /var/lib/hoteldruid/pages/*
      fi
    fi

  else
    # If debconf is not installed only remove apache conf, leaving /var/lib/hoteldruid/
    rm -f /etc/apache2/conf.d/hoteldruid.conf
  fi


  # Shell function to check if command is exists
  pathfindhd() {
    OLDIFS="$IFS"
    IFS=:
    for p in $PATH; do
      if [ -x "$p/$*" ]; then
        IFS="$OLDIFS"
        return 0
      fi
    done
    IFS="$OLDIFS"
    return 1
  }


  set +e
  pathfindhd ucf
  EXIT_CODE=$?
  set -e
  if [ $EXIT_CODE -eq 0 ]; then
    ucf --purge /etc/hoteldruid/apache2.conf
  fi
  set +e
  pathfindhd ucfr
  EXIT_CODE=$?
  set -e
  if [ $EXIT_CODE -eq 0 ]; then
    ucfr --purge hoteldruid /etc/hoteldruid/apache2.conf
  fi
  for ext in '' '~' '%' .bak .ucf-new .ucf-old .ucf-dist;  do
    rm -f /etc/hoteldruid/apache2.conf$ext
  done
  
  ;;


  remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
  ;;

  *)
    echo "postrm called with unknown argument \`$1'" >&2
    exit 1
  ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
